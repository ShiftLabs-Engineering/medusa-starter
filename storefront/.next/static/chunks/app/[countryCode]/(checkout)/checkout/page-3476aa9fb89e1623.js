(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6101],{14351:(e,s,l)=>{"use strict";l.r(s),l.d(s,{UpsertAddressForm:()=>c});var n=l(96036),a=l(96456),i=l(84735),r=l(27251),t=l(85676),d=l(64194),o=l(27003);let c=(0,l(55118).R)(e=>{let{addressId:s,region:l,defaultValues:c}=e,{close:u}=a.useContext(i.RG),{mutate:p,isPending:m,data:h}=(0,o.x$)(s);return(0,n.jsx)(r.lV,{onSubmit:e=>{p(e,{onSuccess:e=>{e.success&&u()}})},schema:o.uE,defaultValues:{first_name:null==c?void 0:c.first_name,last_name:null==c?void 0:c.last_name,company:null==c?void 0:c.company,address_1:null==c?void 0:c.address_1,address_2:null==c?void 0:c.address_2,phone:null==c?void 0:c.phone,city:null==c?void 0:c.city,postal_code:null==c?void 0:c.postal_code,country_code:null==c?void 0:c.country_code,province:null==c?void 0:c.province},children:e=>{let{setValue:a,watch:i}=e,o=i(),u=!Object.values(o).some(e=>e)||!!c&&!Object.entries(o).some(e=>{let[s,l]=e;return c[s]!==l});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-md mb-8 md:mb-10",children:s?"Change address":"Add another address"}),(0,n.jsxs)("div",{className:"flex flex-col gap-4 md:gap-8 mb-8 md:mb-10",children:[(0,n.jsxs)("div",{className:"flex max-xs:flex-col gap-4 md:gap-6",children:[(0,n.jsx)(r.FO,{placeholder:"First name",name:"first_name",className:" flex-1",inputProps:{autoComplete:"given-name"}}),(0,n.jsx)(r.FO,{placeholder:"Last name",name:"last_name",className:" flex-1",inputProps:{autoComplete:"family-name"}})]}),(0,n.jsx)(r.FO,{placeholder:"Company (Optional)",name:"company",className:" flex-1",inputProps:{autoComplete:"organization"}}),(0,n.jsx)(r.FO,{placeholder:"Address",name:"address_1",inputProps:{autoComplete:"address-line1"}}),(0,n.jsx)(r.FO,{placeholder:"Apartment, suite, etc. (Optional)",name:"address_2",inputProps:{autoComplete:"address-line2"}}),(0,n.jsx)(r.FO,{placeholder:"Phone (Optional)",name:"phone",type:"tel",inputProps:{autoComplete:"tel"}}),(0,n.jsxs)("div",{className:"flex max-xs:flex-col gap-4 md:gap-6",children:[(0,n.jsx)(r.FO,{placeholder:"Postal code",name:"postal_code",className:" flex-1",inputProps:{autoComplete:"postal-code"}}),(0,n.jsx)(r.FO,{placeholder:"City",name:"city",className:" flex-1",inputProps:{autoComplete:"address-level2"}})]}),(0,n.jsxs)("div",{className:"flex max-xs:flex-col gap-4 md:gap-6",children:[(0,n.jsx)(r.FO,{placeholder:"Province (Optional)",name:"province",className:" flex-1",inputProps:{autoComplete:"address-level1"}}),(0,n.jsx)(r.nk,{selectProps:{region:null!=l?l:void 0,defaultSelectedKey:null==c?void 0:c.country_code,autoComplete:"country",onSelectionChange:e=>a("country_code","".concat(e))},name:"country_code",className:"flex-1"})]}),!(null==h?void 0:h.success)&&(0,n.jsx)("p",{className:"text-red-primary",children:null==h?void 0:h.error})]}),(0,n.jsxs)("div",{className:"flex gap-6 justify-between",children:[(0,n.jsx)(d.SubmitButton,{isLoading:m,isDisabled:u,children:s?"Save changes":"Add address"}),(0,n.jsx)(t.UiCloseButton,{variant:"outline",children:"Cancel"})]})]})}})})},14426:(e,s,l)=>{"use strict";l.d(s,{Fr:()=>o,Y6:()=>t,cT:()=>c,x1:()=>d});var n=l(96036),a=l(43827),i=l(88942),r=l(63876);let t=e=>{let{className:s,...l}=e;return(0,n.jsx)(a.Sc,{...l,className:(0,i.QP)("flex gap-2 group cursor-pointer items-center",s)})},d=e=>{let{className:s,...l}=e;return(0,n.jsx)("div",{...l,className:(0,i.QP)("border border-grayscale-200 w-4 h-4 flex items-center group-hover:border-grayscale-600 justify-center group-data-[selected=true]:bg-black group-data-[selected=true]:border-black group-hover:group-data-[selected=true]:border-grayscale-600 group-hover:group-data-[selected=true]:bg-grayscale-600 transition-colors",s)})},o=e=>{let{name:s="check",className:l,...a}=e;return(0,n.jsx)(r.I,{...a,name:s,className:(0,i.QP)("w-3 h-3 group-data-[selected=false]:opacity-0 group-data-[selected=true]:opacity-1 text-white",l)})},c=e=>{let{className:s,...l}=e;return(0,n.jsx)("span",{...l,className:s})}},32566:(e,s,l)=>{"use strict";l.d(s,{KC:()=>o,UiRadioGroup:()=>r,jC:()=>d,wE:()=>t});var n=l(96036),a=l(70382),i=l(88942);let r=e=>{let{...s}=e;return(0,n.jsx)(a.z6,{...s})},t=e=>{let{variant:s="ghost",className:l,...r}=e;return(0,n.jsx)(a.sx,{...r,className:(0,i.QP)("flex gap-2 group cursor-pointer items-center","outline"===s&&"p-4 gap-4 border border-grayscale-200 hover:border-grayscale-500 transition-colors",l)})},d=e=>{let{className:s,...l}=e;return(0,n.jsx)("span",{...l,className:(0,i.QP)("border border-grayscale-200 w-4 h-4 block transition-colors rounded-full group-hover:border-grayscale-600 group-data-[selected]:border-black group-data-[selected]:border-6 group-hover:group-data-[selected]:border-grayscale-600",s)})},o=e=>{let{className:s,...l}=e;return(0,n.jsx)("span",{...l,className:s})}},52343:(e,s,l)=>{Promise.resolve().then(l.bind(l,85035))},55888:(e,s,l)=>{"use strict";l.d(s,{LoginForm:()=>m});var n=l(96036);l(96456);var a=l(64194),i=l(27251),r=l(83275),t=l(88942),d=l(81793),o=l(27003),c=l(55118),u=l(35474);let p=d.z.object({email:d.z.string().email(),password:d.z.string().min(6)}),m=(0,c.R)(e=>{let{className:s,redirectUrl:l,handleCheckout:d}=e,{isPending:c,data:m,mutate:h}=(0,o.vz)(),g=(0,u.useRouter)();return(0,n.jsx)(i.lV,{onSubmit:e=>{h({...e,redirect_url:l},{onSuccess:s=>{d&&s.success?d({email:e.email}):s.success&&g.push(s.redirectUrl||"/")}})},schema:p,children:(0,n.jsxs)("div",{className:(0,t.QP)("flex flex-col gap-6 md:gap-8",s),children:[(0,n.jsx)(i.FO,{placeholder:"Email",name:"email",inputProps:{autoComplete:"email"},className:"flex-1"}),(0,n.jsx)(i.FO,{placeholder:"Password",name:"password",type:"password",className:"flex-1",inputProps:{autoComplete:"current-password"}}),(0,n.jsx)(r.LocalizedLink,{href:"/auth/forgot-password",variant:"underline",className:"self-start !pb-0 text-grayscale-500 leading-none",children:"Forgot password?"}),!(null==m?void 0:m.success)&&(0,n.jsx)("p",{className:"text-red-primary text-sm",children:null==m?void 0:m.message}),(0,n.jsx)(a.SubmitButton,{isLoading:c,children:"Log in"})]})})})},60316:(e,s,l)=>{"use strict";l.r(s),l.d(s,{UiModal:()=>d,UiModalOverlay:()=>r,getModalClassNames:()=>t});var n=l(96036),a=l(24902),i=l(88942);let r=e=>{let{isDismissable:s=!0,className:l,...r}=e;return(0,n.jsx)(a.mH,{...r,isDismissable:s,className:(0,i.QP)("fixed inset-0 flex min-h-full items-center justify-center bg-black-10% z-50 data-[entering]:animate-in data-[entering]:fade-in data-[entering]:duration-200 data-[entering]:ease-out data-[exiting]:animate-out data-[exiting]:fade-out data-[exiting]:duration-100 data-[exiting]:ease-in p-4",l)})},t=e=>{let{animateFrom:s="center"}=e;return(0,i.Id)("bg-white max-sm:px-4 p-6 rounded-xs max-h-full overflow-y-scroll max-w-154 w-full shadow-modal data-[entering]:animate-in data-[entering]:ease-out data-[entering]:duration-200 data-[exiting]:animate-out data-[exiting]:ease-in data-[exiting]:duration-100",{center:"data-[entering]:zoom-in-95 data-[exiting]:zoom-out-95",right:"data-[entering]:slide-in-from-right-10 data-[exiting]:slide-out-to-right-10 right-0 left-auto absolute",bottom:"data-[entering]:slide-in-from-bottom-10 data-[exiting]:slide-out-to-bottom-10 bottom-0 absolute",left:"data-[entering]:slide-in-from-left-10 data-[exiting]:slide-out-to-left-10 left-0 right-auto absolute"}[s])},d=e=>{let{animateFrom:s="center",className:l,...r}=e;return(0,n.jsx)(a.aF,{...r,className:(0,i.QP)(t({animateFrom:s}),l)})}},85035:(e,s,l)=>{"use strict";l.d(s,{CheckoutForm:()=>em});var n=l(96036),a=l(55118),i=l(96456),r=l(35474),t=l(88265),d=l(55121);let o=e=>{var s,l;let{paymentSession:a,stripeKey:i,stripePromise:r,children:t}=e,o={clientSecret:null==(s=a.data)?void 0:s.client_secret};if(!i)throw Error("Stripe key is missing. Set NEXT_PUBLIC_STRIPE_KEY environment variable.");if(!r)throw Error("Stripe promise is missing. Make sure you have provided a valid Stripe key.");if(!(null==a||null==(l=a.data)?void 0:l.client_secret))throw Error("Stripe client secret is missing. Cannot initialize Stripe.");return(0,n.jsx)(d.Elements,{options:o,stripe:r,children:t})};var c=l(52470),u=l(73594);let p={pp_stripe_stripe:{title:"Credit card",icon:(0,n.jsx)(u.A,{})},"pp_stripe-ideal_stripe":{title:"iDeal",icon:(0,n.jsx)(e=>{let{color:s="currentColor",...l}=e;return(0,n.jsxs)("svg",{width:"20px",height:"20px",viewBox:"0 0 24 24",role:"img",xmlns:"http://www.w3.org/2000/svg",fill:s,...l,children:[(0,n.jsx)("title",{children:"iDEAL icon"}),(0,n.jsx)("path",{d:"M.975 2.61v18.782h11.411c6.89 0 10.64-3.21 10.64-9.415 0-6.377-4.064-9.367-10.64-9.367H.975zm11.411-.975C22.491 1.635 24 8.115 24 11.977c0 6.7-4.124 10.39-11.614 10.39H0V1.635h12.386z M2.506 13.357h3.653v6.503H2.506z M6.602 10.082a2.27 2.27 0 1 1-4.54 0 2.27 2.27 0 0 1 4.54 0m1.396-1.057v2.12h.65c.45 0 .867-.13.867-1.077 0-.924-.463-1.043-.867-1.043h-.65zm10.85-1.054h1.053v3.174h1.56c-.428-5.758-4.958-7.002-9.074-7.002H7.999v3.83h.65c1.183 0 1.92.803 1.92 2.095 0 1.333-.719 2.129-1.92 2.129h-.65v7.665h4.388c6.692 0 9.021-3.107 9.103-7.665h-2.64V7.97zm-2.93 2.358h.76l-.348-1.195h-.063l-.35 1.195zm-1.643 1.87l1.274-4.228h1.497l1.274 4.227h-1.095l-.239-.818H15.61l-.24.818h-1.095zm-.505-1.054v1.052h-2.603V7.973h2.519v1.052h-1.467v.49h1.387v1.05H12.22v.58h1.55z"})]})},{})},"pp_stripe-bancontact_stripe":{title:"Bancontact",icon:(0,n.jsx)(e=>{let{color:s="currentColor",...l}=e;return(0,n.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",role:"img",xmlns:"http://www.w3.org/2000/svg",fill:s,...l,children:[(0,n.jsx)("title",{children:"Bancontact icon"}),(0,n.jsx)("path",{d:"M21.385 9.768h-7.074l-4.293 5.022H1.557L3.84 12.1H1.122C.505 12.1 0 12.616 0 13.25v2.428c0 .633.505 1.15 1.122 1.15h12.933c.617 0 1.46-.384 1.874-.854l1.956-2.225 3.469-3.946.031-.035zm-1.123 1.279l-.751.855.75-.855zm2.616-3.875H9.982c-.617 0-1.462.384-1.876.853l-5.49 6.208h7.047l4.368-5.02h8.424l-2.263 2.689h2.686c.617 0 1.122-.518 1.122-1.151V8.323c0-.633-.505-1.15-1.122-1.15zm-1.87 3.024l-.374.427-.1.114.474-.54z"})]})},{})},pp_paypal_paypal:{title:"PayPal",icon:(0,n.jsx)(()=>(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20",viewBox:"0 0 26 25",id:"paypalIcon",children:[(0,n.jsx)("path",{fill:"none",stroke:"#303c42",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M6.9 20.5H2c-.6 0-.5-.1-.5-.5s2.9-18 3-18.5.5-1 1-1h10c2.8 0 5 2.2 5 5h0c0 4.4-3.6 8-8 8H7.9"}),(0,n.jsx)("path",{fill:"none",stroke:"#303c42",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M7 23.5c-.3 0-.5-.2-.5-.5 0 0 0 0 0 0 0-.3 2.4-16 2.5-16.5s.3-1 1-1h7.5c2.8 0 5 2.2 5 5h0c0 3.9-3.1 7-7 7h-2l-1 6H7z"})]}),{})},pp_system_default:{title:"Manual Payment",icon:(0,n.jsx)(u.A,{})}},m=e=>null==e?void 0:e.startsWith("pp_stripe_"),h=e=>null==e?void 0:e.startsWith("pp_paypal"),g=e=>null==e?void 0:e.startsWith("pp_system_default"),v=(0,i.createContext)(!1),x="sk_test_ab833e3b0c0022e2ffd47011652a7e0031d44130e9bfa6c2",_=x?(0,t.c)(x):null,j=(0,a.R)(e=>{var s,l;let{children:a,cart:i}=e,r=null==(l=i.payment_collection)||null==(s=l.payment_sessions)?void 0:s.find(e=>"pending"===e.status);return m(null==r?void 0:r.provider_id)&&r&&_?(0,n.jsx)(v.Provider,{value:!0,children:(0,n.jsx)(o,{paymentSession:r,stripeKey:x,stripePromise:_,children:a})}):h(null==r?void 0:r.provider_id)&&i?(0,n.jsx)(c.ag,{options:{clientId:"test",currency:null==i?void 0:i.currency_code.toUpperCase(),intent:"authorize",components:"buttons"},children:a}):(0,n.jsx)("div",{children:a})});var y=l(88942),f=l(81793),b=l(64194),N=l(14724),w=l(27251),C=l(85676),P=l(60316),S=l(63876),z=l(55888),F=l(13038),k=l(27003),B=l(57738);let E=f.z.object({email:f.z.string().min(3).email("Enter a valid email address.")}),O=e=>{let{countryCode:s,cart:l}=e,a=(0,r.useSearchParams)(),i=(0,r.useRouter)(),t=(0,r.usePathname)(),{data:d,isPending:o}=(0,k.cN)(),c="email"===a.get("step"),{mutate:u,isPending:p,data:m}=(0,B.U9)(),h=e=>{u({...e,country_code:s},{onSuccess:e=>{c&&(null==e?void 0:e.success)&&i.push(t+"?step=delivery",{scroll:!1})}})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-6 md:mb-8",children:[(0,n.jsxs)("div",{className:"flex justify-between flex-wrap gap-5 flex-1",children:[(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:(0,y.Id)("transition-fontWeight duration-75",c&&"font-semibold"),children:"1. Email"})}),c&&!d&&!o&&(0,n.jsx)("div",{className:"text-grayscale-500",children:(0,n.jsxs)("p",{children:["Already have an account? No worries, just"," ",(0,n.jsxs)(C.UiDialogTrigger,{children:[(0,n.jsx)(N.Button,{variant:"link",children:"log in."}),(0,n.jsx)(P.UiModalOverlay,{children:(0,n.jsx)(P.UiModal,{className:"relative max-w-108",children:(0,n.jsxs)(C.UiDialog,{children:[(0,n.jsx)("p",{className:"text-md mb-10",children:"Log in"}),(0,n.jsx)(z.LoginForm,{redirectUrl:"/".concat(s,"/checkout?step=delivery"),handleCheckout:h}),(0,n.jsx)(C.UiCloseButton,{variant:"ghost",className:"absolute top-4 right-6 p-0",children:(0,n.jsx)(S.I,{name:"close",className:"w-6 h-6"})})]})})})]})]})})]}),!c&&(0,n.jsx)(N.Button,{variant:"link",onPress:()=>{i.push(t+"?step=email")},children:"Change"})]}),c?(0,n.jsx)(w.lV,{schema:E,onSubmit:h,formProps:{id:"email"},defaultValues:{email:(null==l?void 0:l.email)||""},children:e=>{let{watch:s}=e,l=s("email");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.FO,{placeholder:"Email",name:"email",inputProps:{autoComplete:"email",title:"Enter a valid email address."},"data-testid":"shipping-email-input"}),(0,n.jsx)(b.SubmitButton,{className:"mt-8",isLoading:p,isDisabled:!l,children:"Next"}),(0,n.jsx)(F.A,{error:null==m?void 0:m.error})]})}}):(null==l?void 0:l.email)?(0,n.jsxs)("ul",{className:"flex max-sm:flex-col flex-wrap gap-y-2 gap-x-34",children:[(0,n.jsx)("li",{className:"text-grayscale-500",children:"Email"}),(0,n.jsx)("li",{className:"text-grayscale-600 break-all",children:l.email})]}):null]})};var U=l(5633),L=l.n(U),M=l(83610),A=l.n(M);function R(e,s){return L()(A()(e,["first_name","last_name","address_1","address_2","company","postal_code","city","country_code","province","phone"]),A()(s,["first_name","last_name","address_1","address_2","company","postal_code","city","country_code","province","phone"]))}var I=l(70382),D=l(32566),V=l(14351),T=l(12174),H=l(10652);let K=e=>{var s,l,n,a,i,r,t,d,o,c;return!(null==e||null==(s=e.billing_address)?void 0:s.first_name)&&!(null==e||null==(l=e.billing_address)?void 0:l.last_name)&&!(null==e||null==(n=e.billing_address)?void 0:n.address_1)&&!(null==e||null==(a=e.billing_address)?void 0:a.address_2)&&!(null==e||null==(i=e.billing_address)?void 0:i.company)&&!(null==e||null==(r=e.billing_address)?void 0:r.postal_code)&&!(null==e||null==(t=e.billing_address)?void 0:t.city)&&!(null==e||null==(d=e.billing_address)?void 0:d.country_code)&&!(null==e||null==(o=e.billing_address)?void 0:o.province)&&!(null==e||null==(c=e.billing_address)?void 0:c.phone)},Q=e=>{var s,l,a,r,t,d,o,c,u,p,m;let{cart:h,customer:g}=e,v=(0,T.F)(),{setValue:x,watch:_}=(0,H.xW)(),j=e=>{e&&x("billing_address",{first_name:(null==e?void 0:e.first_name)||"",last_name:(null==e?void 0:e.last_name)||"",address_1:(null==e?void 0:e.address_1)||"",company:(null==e?void 0:e.company)||"",postal_code:(null==e?void 0:e.postal_code)||"",city:(null==e?void 0:e.city)||"",country_code:(null==e?void 0:e.country_code)||"",province:(null==e?void 0:e.province)||"",phone:(null==e?void 0:e.phone)||""})},f=_(),b=e=>{x(e.target.name,e.target.value)},z=(0,i.useMemo)(()=>{var e,s;return null==h||null==(s=h.region)||null==(e=s.countries)?void 0:e.map(e=>e.iso_2)},[null==h?void 0:h.region]),F=(0,i.useMemo)(()=>null==g?void 0:g.addresses.filter(e=>e.country_code&&(null==z?void 0:z.includes(e.country_code))),[null==g?void 0:g.addresses,z]);return(0,i.useEffect)(()=>{if(h){if(h.billing_address)j(h.billing_address);else if(g&&F&&F.length&&K(f)){var e,s,l,n,a,i,r,t,d,o;let c=F.find(e=>e.is_default_billing)||F[0];j({first_name:null!=(e=c.first_name)?e:void 0,last_name:null!=(s=c.last_name)?s:void 0,address_1:null!=(l=c.address_1)?l:void 0,address_2:null!=(n=c.address_2)?n:void 0,company:null!=(a=c.company)?a:void 0,postal_code:null!=(i=c.postal_code)?i:void 0,city:null!=(r=c.city)?r:void 0,country_code:null!=(t=c.country_code)?t:void 0,province:null!=(d=c.province)?d:void 0,phone:null!=(o=c.phone)?o:void 0})}}},[h,g,F]),(0,n.jsx)(n.Fragment,{children:g&&((null==F?void 0:F.length)||0)>0&&!K(f)?(0,n.jsxs)("div",{className:"w-full border border-grayscale-200 rounded-xs p-4 flex flex-wrap gap-8 max-lg:flex-col mt-8",children:[(0,n.jsxs)("div",{className:"flex flex-1 gap-8",children:[(0,n.jsx)(S.I,{name:"user",className:"w-6 h-6 mt-2.5"}),(0,n.jsxs)("div",{className:"flex flex-col gap-8 flex-1",children:[(0,n.jsxs)("div",{className:"flex flex-wrap justify-between gap-6",children:[(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Country"}),(0,n.jsx)("p",{children:(null==h||null==(a=h.region)||null==(l=a.countries)||null==(s=l.find(e=>{var s;return e.iso_2===(null==(s=f.billing_address)?void 0:s.country_code)}))?void 0:s.display_name)||(null==(r=f.billing_address)?void 0:r.country_code)})]}),(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Address"}),(0,n.jsx)("p",{children:null==(t=f.billing_address)?void 0:t.address_1})]})]}),(null==(d=f.billing_address)?void 0:d.address_2)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Apartment, suite, etc. (Optional)"}),(0,n.jsx)("p",{children:null==(o=f.billing_address)?void 0:o.address_2})]}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-between gap-6",children:[(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Postal Code"}),(0,n.jsx)("p",{children:null==(c=f.billing_address)?void 0:c.postal_code})]}),(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"City"}),(0,n.jsx)("p",{children:null==(u=f.billing_address)?void 0:u.city})]})]})]})]}),(0,n.jsxs)(C.UiDialogTrigger,{children:[(0,n.jsx)(N.Button,{variant:"outline",size:"sm",className:"shrink-0",children:"Change"}),(0,n.jsx)(P.UiModalOverlay,{children:(0,n.jsx)(P.UiModal,{children:(0,n.jsxs)(C.UiDialog,{children:[(0,n.jsx)("p",{className:"text-md mb-10",children:"Change address"}),(0,n.jsx)(I.z6,{className:"flex flex-col gap-4 mb-10","aria-label":"Shipping methods",onChange:e=>{let s=null==F?void 0:F.find(s=>s.id===e);if(s){var l,n,a,i,r,t,d,o,c,u;j({address_1:null!=(l=s.address_1)?l:void 0,address_2:null!=(n=s.address_2)?n:void 0,city:null!=(a=s.city)?a:void 0,company:null!=(i=s.company)?i:void 0,country_code:null!=(r=s.country_code)?r:void 0,first_name:null!=(t=s.first_name)?t:void 0,last_name:null!=(d=s.last_name)?d:void 0,phone:null!=(o=s.phone)?o:void 0,postal_code:null!=(c=s.postal_code)?c:void 0,province:null!=(u=s.province)?u:void 0})}},value:null==F||null==(p=F.find(e=>{var s,l,n,a,i,r,t,d,o,c,u,p,m,h,g,v,x,_,j,y;return R({first_name:null!=(u=e.first_name)?u:"",last_name:null!=(p=e.last_name)?p:"",address_1:null!=(m=e.address_1)?m:"",address_2:null!=(h=e.address_2)?h:"",company:null!=(g=e.company)?g:"",postal_code:null!=(v=e.postal_code)?v:"",city:null!=(x=e.city)?x:"",country_code:null!=(_=e.country_code)?_:"",province:null!=(j=e.province)?j:"",phone:null!=(y=e.phone)?y:""},{first_name:null==(s=f.billing_address)?void 0:s.first_name,last_name:null==(l=f.billing_address)?void 0:l.last_name,address_1:null==(n=f.billing_address)?void 0:n.address_1,address_2:null==(a=f.billing_address)?void 0:a.address_2,company:null==(i=f.billing_address)?void 0:i.company,postal_code:null==(r=f.billing_address)?void 0:r.postal_code,city:null==(t=f.billing_address)?void 0:t.city,country_code:null==(d=f.billing_address)?void 0:d.country_code,province:null==(o=f.billing_address)?void 0:o.province,phone:null==(c=f.billing_address)?void 0:c.phone})}))?void 0:p.id,children:null==F?void 0:F.map(e=>{var s,l,a;return(0,n.jsxs)(D.wE,{variant:"outline",value:e.id,className:"gap-4",id:e.id,children:[(0,n.jsx)(D.jC,{}),(0,n.jsx)(D.KC,{children:[e.first_name,e.last_name].filter(Boolean).join(" ")}),(0,n.jsx)(D.KC,{className:"ml-auto text-grayscale-500 group-data-[selected=true]:font-normal",children:[e.address_1,e.address_2,[e.postal_code,e.city].filter(Boolean).join(" "),(null==h||null==(a=h.region)||null==(l=a.countries)||null==(s=l.find(s=>s.iso_2===e.country_code))?void 0:s.display_name)||e.country_code].filter(Boolean).join(", ")})]},e.id)})}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)(C.UiDialogTrigger,{children:[(0,n.jsx)(N.Button,{children:"Add new address"}),(0,n.jsx)(P.UiModalOverlay,{children:(0,n.jsx)(P.UiModal,{children:(0,n.jsx)(C.UiDialog,{children:(0,n.jsx)(V.UpsertAddressForm,{region:null==h?void 0:h.region,defaultValues:{country_code:v}})})})})]}),(0,n.jsx)(C.UiCloseButton,{variant:"outline",children:"Close"})]})]})})})]})]}):(0,n.jsxs)("div",{className:(0,y.QP)("grid grid-cols-2 gap-4 mt-8"),children:[(0,n.jsx)(w.FO,{placeholder:"First name",name:"billing_address.first_name",inputProps:{autoComplete:"given-name"},"data-testid":"billing-first-name-input"}),(0,n.jsx)(w.FO,{placeholder:"Last name",name:"billing_address.last_name",inputProps:{autoComplete:"family-name"},"data-testid":"billing-last-name-input"}),(0,n.jsx)(w.FO,{placeholder:"Address",name:"billing_address.address_1",inputProps:{autoComplete:"address-line1"},"data-testid":"billing-address-input"}),(0,n.jsx)(w.FO,{placeholder:"Company",name:"billing_address.company",inputProps:{autoComplete:"company"},"data-testid":"billing-company-input"}),(0,n.jsx)(w.FO,{placeholder:"Postal code",name:"billing_address.postal_code",inputProps:{autoComplete:"postal-code"},"data-testid":"billing-postal-input"}),(0,n.jsx)(w.FO,{placeholder:"City",name:"billing_address.city",inputProps:{autoComplete:"address-level2"},"data-testid":"billing-city-input"}),(0,n.jsx)(w.nk,{name:"billing_address.country_code",selectProps:{autoComplete:"country",region:null==h?void 0:h.region,selectedKey:(null==(m=f.billing_address)?void 0:m.country_code)||null,onSelectionChange:e=>b({target:{name:"billing_address.country_code",value:"".concat(e)}})},"data-testid":"billing-country-select"}),(0,n.jsx)(w.FO,{placeholder:"State / Province",name:"billing_address.province",inputProps:{autoComplete:"address-level1"},"data-testid":"billing-province-input"}),(0,n.jsx)(w.FO,{placeholder:"Phone",name:"billing_address.phone",inputProps:{autoComplete:"tel"},"data-testid":"billing-phone-input"})]})})};var W=l(14426);let G=e=>{var s,l,n,a,i,r,t,d,o,c;return!(null==e||null==(s=e.shipping_address)?void 0:s.first_name)&&!(null==e||null==(l=e.shipping_address)?void 0:l.last_name)&&!(null==e||null==(n=e.shipping_address)?void 0:n.address_1)&&!(null==e||null==(a=e.shipping_address)?void 0:a.address_2)&&!(null==e||null==(i=e.shipping_address)?void 0:i.company)&&!(null==e||null==(r=e.shipping_address)?void 0:r.postal_code)&&!(null==e||null==(t=e.shipping_address)?void 0:t.city)&&!(null==e||null==(d=e.shipping_address)?void 0:d.country_code)&&!(null==e||null==(o=e.shipping_address)?void 0:o.province)&&!(null==e||null==(c=e.shipping_address)?void 0:c.phone)},Y=e=>{var s,l,a,r;let{customer:t,cart:d,checked:o,onChange:c}=e,u=(0,T.F)(),{setValue:p,control:m}=(0,H.xW)(),h=(0,H.FH)({control:m}),g=(0,i.useMemo)(()=>{var e,s;return null==d||null==(s=d.region)||null==(e=s.countries)?void 0:e.map(e=>e.iso_2)},[null==d?void 0:d.region]),v=(0,i.useMemo)(()=>null==t?void 0:t.addresses.filter(e=>e.country_code&&(null==g?void 0:g.includes(e.country_code))),[null==t?void 0:t.addresses,g]),x=e=>{e&&p("shipping_address",{first_name:(null==e?void 0:e.first_name)||"",last_name:(null==e?void 0:e.last_name)||"",address_1:(null==e?void 0:e.address_1)||"",company:(null==e?void 0:e.company)||"",postal_code:(null==e?void 0:e.postal_code)||"",city:(null==e?void 0:e.city)||"",country_code:(null==e?void 0:e.country_code)||"",province:(null==e?void 0:e.province)||"",phone:(null==e?void 0:e.phone)||""})};(0,i.useEffect)(()=>{if(d){if(d.shipping_address)x(d.shipping_address);else if(t&&v&&v.length&&G(h)){var e,s,l,n,a,i,r,o,c,u;let t=v.find(e=>e.is_default_shipping)||v[0];x({first_name:null!=(e=t.first_name)?e:void 0,last_name:null!=(s=t.last_name)?s:void 0,address_1:null!=(l=t.address_1)?l:void 0,address_2:null!=(n=t.address_2)?n:void 0,company:null!=(a=t.company)?a:void 0,postal_code:null!=(i=t.postal_code)?i:void 0,city:null!=(r=t.city)?r:void 0,country_code:null!=(o=t.country_code)?o:void 0,province:null!=(c=t.province)?c:void 0,phone:null!=(u=t.phone)?u:void 0})}}},[d,t,v]);let _=e=>{p(e.target.name,e.target.value)};return(0,n.jsxs)(n.Fragment,{children:[t&&((null==v?void 0:v.length)||0)>0&&!G(h)?(0,n.jsxs)("div",{className:"w-full border border-grayscale-200 rounded-xs p-4 flex flex-wrap gap-8 max-lg:flex-col mb-8",children:[(0,n.jsxs)("div",{className:"flex flex-1 gap-8",children:[(0,n.jsx)(S.I,{name:"user",className:"w-6 h-6 mt-2.5"}),(0,n.jsxs)("div",{className:"flex flex-col gap-8 flex-1",children:[(0,n.jsxs)("div",{className:"flex flex-wrap justify-between gap-6",children:[(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Country"}),(0,n.jsx)("p",{children:(null==d||null==(a=d.region)||null==(l=a.countries)||null==(s=l.find(e=>e.iso_2===h.shipping_address.country_code))?void 0:s.display_name)||h.shipping_address.country_code})]}),(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Address"}),(0,n.jsx)("p",{children:h.shipping_address.address_1})]})]}),h.shipping_address.address_2&&(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Apartment, suite, etc. (Optional)"}),(0,n.jsx)("p",{children:h.shipping_address.address_2})]}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-between gap-6",children:[(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"Postal Code"}),(0,n.jsx)("p",{children:h.shipping_address.postal_code})]}),(0,n.jsxs)("div",{className:"grow basis-0",children:[(0,n.jsx)("p",{className:"text-xs text-grayscale-500 mb-1.5",children:"City"}),(0,n.jsx)("p",{children:h.shipping_address.city})]})]})]})]}),(0,n.jsxs)(C.UiDialogTrigger,{children:[(0,n.jsx)(N.Button,{variant:"outline",size:"sm",className:"shrink-0",children:"Change"}),(0,n.jsx)(P.UiModalOverlay,{children:(0,n.jsx)(P.UiModal,{children:(0,n.jsxs)(C.UiDialog,{children:[(0,n.jsx)("p",{className:"text-md mb-10",children:"Change address"}),(0,n.jsx)(I.z6,{className:"flex flex-col gap-4 mb-10","aria-label":"Shipping methods",onChange:e=>{let s=null==v?void 0:v.find(s=>s.id===e);if(s){var l,n,a,i,r,t,d,o,c,u;x({address_1:null!=(l=s.address_1)?l:void 0,address_2:null!=(n=s.address_2)?n:void 0,city:null!=(a=s.city)?a:void 0,company:null!=(i=s.company)?i:void 0,country_code:null!=(r=s.country_code)?r:void 0,first_name:null!=(t=s.first_name)?t:void 0,last_name:null!=(d=s.last_name)?d:void 0,phone:null!=(o=s.phone)?o:void 0,postal_code:null!=(c=s.postal_code)?c:void 0,province:null!=(u=s.province)?u:void 0})}},value:null==v||null==(r=v.find(e=>{var s,l,n,a,i,r,t,d,o,c;return R({first_name:null!=(s=e.first_name)?s:"",last_name:null!=(l=e.last_name)?l:"",address_1:null!=(n=e.address_1)?n:"",address_2:null!=(a=e.address_2)?a:"",company:null!=(i=e.company)?i:"",postal_code:null!=(r=e.postal_code)?r:"",city:null!=(t=e.city)?t:"",country_code:null!=(d=e.country_code)?d:"",province:null!=(o=e.province)?o:"",phone:null!=(c=e.phone)?c:""},{first_name:h.shipping_address.first_name,last_name:h.shipping_address.last_name,address_1:h.shipping_address.address_1,address_2:h.shipping_address.address_2,company:h.shipping_address.company,postal_code:h.shipping_address.postal_code,city:h.shipping_address.city,country_code:h.shipping_address.country_code,province:h.shipping_address.province,phone:h.shipping_address.phone})}))?void 0:r.id,children:null==v?void 0:v.map(e=>{var s,l,a;return(0,n.jsxs)(D.wE,{variant:"outline",value:e.id,className:"gap-4",id:e.id,children:[(0,n.jsx)(D.jC,{}),(0,n.jsx)(D.KC,{children:[e.first_name,e.last_name].filter(Boolean).join(" ")}),(0,n.jsx)(D.KC,{className:"ml-auto text-grayscale-500 group-data-[selected=true]:font-normal",children:[e.address_1,e.address_2,[e.postal_code,e.city].filter(Boolean).join(" "),(null==d||null==(a=d.region)||null==(l=a.countries)||null==(s=l.find(s=>s.iso_2===e.country_code))?void 0:s.display_name)||e.country_code].filter(Boolean).join(", ")})]},e.id)})}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)(C.UiDialogTrigger,{children:[(0,n.jsx)(N.Button,{children:"Add new address"}),(0,n.jsx)(P.UiModalOverlay,{children:(0,n.jsx)(P.UiModal,{children:(0,n.jsx)(C.UiDialog,{children:(0,n.jsx)(V.UpsertAddressForm,{region:null==d?void 0:d.region,defaultValues:{country_code:u}})})})})]}),(0,n.jsx)(C.UiCloseButton,{variant:"outline",children:"Close"})]})]})})})]})]}):(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[(0,n.jsx)(w.FO,{placeholder:"First name",name:"shipping_address.first_name",inputProps:{autoComplete:"given-name"},"data-testid":"shipping-first-name-input"}),(0,n.jsx)(w.FO,{placeholder:"Last name",name:"shipping_address.last_name",inputProps:{autoComplete:"family-name"},"data-testid":"shipping-last-name-input"}),(0,n.jsx)(w.FO,{placeholder:"Address",name:"shipping_address.address_1",inputProps:{autoComplete:"address-line1"},"data-testid":"shipping-address-input"}),(0,n.jsx)(w.FO,{placeholder:"Company",name:"shipping_address.company",inputProps:{autoComplete:"organization"},"data-testid":"shipping-company-input"}),(0,n.jsx)(w.FO,{placeholder:"Postal code",name:"shipping_address.postal_code",inputProps:{autoComplete:"postal-code"},"data-testid":"shipping-postal-code-input"}),(0,n.jsx)(w.FO,{placeholder:"City",name:"shipping_address.city",inputProps:{autoComplete:"address-level2"},"data-testid":"shipping-city-input"}),(0,n.jsx)(w.nk,{name:"shipping_address.country_code",selectProps:{autoComplete:"country",region:null==d?void 0:d.region,selectedKey:h["shipping_address.country_code"]||null,onSelectionChange:e=>{_({target:{name:"shipping_address.country_code",value:"".concat(e)}})}},"data-testid":"shipping-country-select"}),(0,n.jsx)(w.FO,{placeholder:"State / Province",name:"shipping_address.province",inputProps:{autoComplete:"address-level1"},"data-testid":"shipping-province-input"}),(0,n.jsx)(w.FO,{placeholder:"Phone",name:"shipping_address.phone",inputProps:{autoComplete:"tel"},"data-testid":"shipping-phone-input"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"hidden",name:"same_as_billing",value:o?"on":"off"}),(0,n.jsxs)(W.Y6,{name:"same_as_billing",isSelected:o,onChange:()=>{p("same_as_billing",o?"off":"on"),c()},"data-testid":"billing-address-checkbox",children:[(0,n.jsx)(W.x1,{children:(0,n.jsx)(W.Fr,{})}),(0,n.jsx)(W.cT,{children:"Billing address same as shipping address"})]})]})]})},$=f.z.object({shipping_address:f.z.object({first_name:f.z.string().min(1),last_name:f.z.string().min(1),company:f.z.string().optional(),address_1:f.z.string().min(1),address_2:f.z.string().optional(),city:f.z.string().min(1),postal_code:f.z.string().min(1),province:f.z.string().optional(),country_code:f.z.string().min(2),phone:f.z.string().optional()})}).and(f.z.discriminatedUnion("same_as_billing",[f.z.object({same_as_billing:f.z.literal("on")}),f.z.object({same_as_billing:f.z.literal("off").optional(),billing_address:f.z.object({first_name:f.z.string().min(1),last_name:f.z.string().min(1),company:f.z.string().optional(),address_1:f.z.string().min(1),address_2:f.z.string().optional(),city:f.z.string().min(1),postal_code:f.z.string().min(1),province:f.z.string().optional(),country_code:f.z.string().min(2),phone:f.z.string().optional()})})])),q=e=>{var s,l,a,t,d,o,c,u,p;let{cart:m}=e,h=(0,r.useSearchParams)(),g=(0,r.useRouter)(),v=(0,r.usePathname)(),x="delivery"===h.get("step"),[_,j]=i.useState(!0),{data:f}=(0,k.cN)();i.useEffect(()=>{(null==m?void 0:m.shipping_address)&&(null==m?void 0:m.billing_address)&&j(R(m.shipping_address,m.billing_address))},[null==m?void 0:m.billing_address,null==m?void 0:m.shipping_address]);let C=i.useCallback(()=>{j(e=>!e)},[j]),{mutate:P,isPending:S,data:z}=(0,B.SP)();return m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-6 md:mb-8 border-t border-grayscale-200 pt-8 mt-8",children:[(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:(0,y.Id)("transition-fontWeight duration-75",x&&"font-semibold"),children:"2. Delivery details"})}),!x&&(null==m?void 0:m.shipping_address)&&(0,n.jsx)(N.Button,{variant:"link",onPress:()=>{g.push(v+"?step=delivery")},children:"Change"})]}),x?(0,n.jsx)(w.lV,{schema:$,onSubmit:e=>{P(e,{onSuccess:e=>{x&&e.success&&g.push(v+"?step=shipping",{scroll:!1})}})},formProps:{id:"email"},defaultValues:_?{shipping_address:(null==m?void 0:m.shipping_address)||{first_name:"",last_name:"",company:"",province:"",city:"",postal_code:"",country_code:"",address_1:"",address_2:"",phone:""},same_as_billing:"on"}:{shipping_address:(null==m?void 0:m.shipping_address)||{first_name:"",last_name:"",company:"",province:"",city:"",postal_code:"",country_code:"",address_1:"",address_2:"",phone:""},same_as_billing:"off",billing_address:(null==m?void 0:m.billing_address)||{first_name:"",last_name:"",company:"",province:"",city:"",postal_code:"",country_code:"",address_1:"",address_2:"",phone:""}},children:e=>{var s;let{watch:l}=e,a=l("shipping_address"),i=!(null==f||null==(s=f.addresses)?void 0:s.length)&&!Object.values(a).some(e=>e);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Y,{customer:f||null,checked:_,onChange:C,cart:m}),!_&&(0,n.jsx)(Q,{cart:m,customer:f||null}),(0,n.jsx)(b.SubmitButton,{className:"mt-8",isLoading:S,isDisabled:i,children:"Next"}),(0,n.jsx)(F.A,{error:null==z?void 0:z.error})]})}}):(null==m?void 0:m.shipping_address)?(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsxs)("div",{className:"flex max-sm:flex-col flex-wrap gap-y-2 gap-x-12",children:[(0,n.jsx)("div",{className:"text-grayscale-500",children:"Shipping address"}),(0,n.jsxs)("div",{className:"text-grayscale-600",children:[[m.shipping_address.first_name,m.shipping_address.last_name].filter(Boolean).join(" "),(0,n.jsx)("br",{}),[m.shipping_address.address_1,m.shipping_address.address_2].filter(Boolean).join(" "),(0,n.jsx)("br",{}),[m.shipping_address.postal_code,m.shipping_address.city].filter(Boolean).join(" "),(0,n.jsx)("br",{}),null==(s=m.shipping_address.country_code)?void 0:s.toUpperCase(),(0,n.jsx)("br",{}),m.shipping_address.phone]})]}),_||m.billing_address?(0,n.jsxs)("div",{className:"flex max-sm:flex-col flex-wrap gap-y-2 gap-x-17",children:[(0,n.jsx)("div",{className:"text-grayscale-500",children:"Billing address"}),(0,n.jsx)("div",{className:"text-grayscale-600",children:_?"Same as shipping address":(0,n.jsxs)(n.Fragment,{children:[[null==(l=m.billing_address)?void 0:l.first_name,null==(a=m.billing_address)?void 0:a.last_name].filter(Boolean).join(" "),(0,n.jsx)("br",{}),[null==(t=m.billing_address)?void 0:t.address_1,null==(d=m.billing_address)?void 0:d.address_2].filter(Boolean).join(" "),(0,n.jsx)("br",{}),[null==(o=m.billing_address)?void 0:o.postal_code,null==(c=m.billing_address)?void 0:c.city].filter(Boolean).join(" "),(0,n.jsx)("br",{}),null==(p=m.billing_address)||null==(u=p.country_code)?void 0:u.toUpperCase()]})})]}):null]}):null]}):null};var Z=l(8552);let J=e=>{var s,l,a;let{cart:t}=e,[d,o]=(0,i.useState)(null),c=(0,r.useSearchParams)(),u=(0,r.useRouter)(),p=(0,r.usePathname)(),m="shipping"===c.get("step"),{data:h}=(0,B._j)(t.id),{mutate:g,isPending:v}=(0,B.L_)({cartId:t.id}),x=null==h?void 0:h.find(e=>{var s,l;return e.id===(null==(l=t.shipping_methods)||null==(s=l[0])?void 0:s.shipping_option_id)});return(0,i.useEffect)(()=>{o(null)},[m]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-6 md:mb-8 border-t border-grayscale-200 pt-8 mt-8",children:[(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:(0,y.Id)("transition-fontWeight duration-75",m&&"font-semibold"),children:"3. Shipping"})}),!m&&(null==t?void 0:t.shipping_address)&&(null==t?void 0:t.billing_address)&&(null==t?void 0:t.email)&&(0,n.jsx)(N.Button,{variant:"link",onPress:()=>{u.push(p+"?step=shipping",{scroll:!1})},children:"Change"})]}),m?(null==h?void 0:h.length)===0?(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-red-900",children:"There are no shipping methods available for your location. Please contact us for further assistance."})}):(0,n.jsxs)("div",{children:[(0,n.jsx)(D.UiRadioGroup,{className:"flex flex-col gap-4 mb-8",value:null==x?void 0:x.id,onChange:e=>{g({shippingMethodId:e},{onError:e=>o(e.message)})},"aria-label":"Shipping methods",children:null==h?void 0:h.map(e=>(0,n.jsxs)(D.wE,{variant:"outline",value:e.id,className:"gap-4",children:[(0,n.jsx)(D.jC,{}),(0,n.jsx)(D.KC,{children:e.name}),(0,n.jsx)(D.KC,{className:"ml-auto group-data-[selected=true]:font-normal",children:(0,Z.$)({amount:e.amount,currency_code:null==t?void 0:t.currency_code})})]},e.id))}),(0,n.jsx)(F.A,{error:d}),(0,n.jsx)(N.Button,{onPress:()=>{u.push(p+"?step=payment",{scroll:!1})},isLoading:v,isDisabled:!(null==(s=t.shipping_methods)?void 0:s[0]),children:"Next"})]}):t&&(null!=(a=null==(l=t.shipping_methods)?void 0:l.length)?a:0)>0&&x?(0,n.jsxs)("ul",{className:"flex max-sm:flex-col flex-wrap gap-y-2 gap-x-28",children:[(0,n.jsx)("li",{className:"text-grayscale-500",children:"Shipping"}),(0,n.jsx)("li",{className:"text-grayscale-600",children:x.name})]}):null]})};var X=l(77813),ee=l.n(X);let es=e=>{var s,l;let{paymentProviderId:a,paymentInfoMap:i,disabled:r=!1}=e;return(0,n.jsxs)(D.wE,{variant:"outline",value:a,isDisabled:r,className:"gap-4",children:[(0,n.jsx)(D.jC,{}),(0,n.jsxs)(D.KC,{children:[(null==(s=i[a])?void 0:s.title)||a,g(a)&&!1]}),(0,n.jsx)("span",{className:"ml-auto group-data-[selected=true]:font-normal",children:null==(l=i[a])?void 0:l.icon})]},a)},el=e=>{var s,l;let{cart:a,isLoading:i,setIsLoading:t,cardComplete:o,createQueryString:c,setError:u}=e,p=(0,d.useStripe)(),h=(0,d.useElements)(),g=null==h?void 0:h.getElement("card"),v=(0,r.useRouter)(),x=(0,B.Ti)(),_=null==(l=a.payment_collection)||null==(s=l.payment_sessions)?void 0:s.find(e=>"pending"===e.status),j=(0,r.usePathname)(),y=(0,B.Zs)(),f=async()=>{t(!0);try{let t=!_;if(m(null==_?void 0:_.provider_id)||await y.mutateAsync({providerId:"stripe"}),!t){if(g){var e,s,l,n,i,r,d,o,h,f,b,N,w,C,P;let t=await (null==p?void 0:p.createToken(g,{name:(null==(e=a.billing_address)?void 0:e.first_name)+" "+(null==(s=a.billing_address)?void 0:s.last_name),address_line1:null!=(h=null==(l=a.billing_address)?void 0:l.address_1)?h:void 0,address_line2:null!=(f=null==(n=a.billing_address)?void 0:n.address_2)?f:void 0,address_city:null!=(b=null==(i=a.billing_address)?void 0:i.city)?b:void 0,address_country:null!=(N=null==(r=a.billing_address)?void 0:r.country_code)?N:void 0,address_zip:null!=(w=null==(d=a.billing_address)?void 0:d.postal_code)?w:void 0,address_state:null!=(C=null==(o=a.billing_address)?void 0:o.province)?C:void 0}));t&&await x.mutateAsync({sessionId:_.id,token:null==(P=t.token)?void 0:P.id})}return v.push(j+"?"+c("step","review"),{scroll:!1})}}catch(e){u(e instanceof Error?e.message:"".concat(e))}finally{t(!1)}};return(0,n.jsx)(N.Button,{className:"mt-6",onPress:f,isLoading:i,isDisabled:!o,"data-testid":"submit-payment-button",children:_?"Continue to review":"Enter card details"})},en=e=>{let{isLoading:s,setIsLoading:l,createQueryString:a,selectedPaymentMethod:i,setError:t}=e,d=(0,r.useRouter)(),o=(0,r.usePathname)(),c=(0,B.Zs)();return(0,n.jsx)(N.Button,{className:"mt-6",onPress:()=>{l(!0),c.mutate({providerId:i},{onSuccess:()=>{if(!m(i))return d.push(o+"?"+a("step","review"),{scroll:!1});l(!1)},onError:e=>{t(e instanceof Error?e.message:"".concat(e)),l(!1)}})},isLoading:s,"data-testid":"submit-payment-button",isDisabled:!i,children:m(i)?"Enter card details":"Continue to review"})},ea=(0,a.R)(e=>{var s,l;let{cart:a,isLoading:i,setIsLoading:r,cardComplete:t,createQueryString:d,selectedPaymentMethod:o,setError:c}=e,u=null==(l=a.payment_collection)||null==(s=l.payment_sessions)?void 0:s.find(e=>"pending"===e.status);return m(null==u?void 0:u.provider_id)&&m(o)?(0,n.jsx)(el,{setError:c,cart:a,isLoading:i,setIsLoading:r,cardComplete:t,createQueryString:d}):(0,n.jsx)(en,{setError:c,cart:a,isLoading:i,setIsLoading:r,createQueryString:d,selectedPaymentMethod:o})}),ei=e=>{var s,l,a,t,o,c,h,g,x;let{cart:_}=e,[j,f]=(0,i.useState)(!1),[b,C]=(0,i.useState)(null),[P,S]=(0,i.useState)(null),[z,k]=(0,i.useState)(!1),E=(0,r.useSearchParams)(),O=(0,r.useRouter)(),U=(0,r.usePathname)(),L="payment"===E.get("step"),M=(0,i.useMemo)(()=>({style:{base:{fontFamily:"Inter, sans-serif",color:"#050505","::placeholder":{color:"#808080"},fontSize:"16px"}},classes:{base:"pt-[18px] pb-1 block w-full h-14.5 px-4 mt-0 border rounded-xs appearance-none focus:outline-none focus:ring-0 border-grayscale-200 hover:border-grayscale-500 focus:border-grayscale-500 transition-all ease-in-out"}}),[]),A=(0,i.useCallback)((e,s)=>{let l=new URLSearchParams(E);return l.set(e,s),l.toString()},[E]);(0,i.useEffect)(()=>{C(null)},[L]);let R=(0,B.Ti)(),I=null==_||null==(l=_.payment_collection)||null==(s=l.payment_sessions)?void 0:s.find(e=>"pending"===e.status),[V,T]=(0,i.useState)(null!=(g=null==I?void 0:I.provider_id)?g:""),{data:H}=(0,B._9)(null!=(x=null==_||null==(a=_.region)?void 0:a.id)?x:""),K=m(null==I?void 0:I.provider_id),Q=(0,i.useContext)(v),W=null==I||null==(t=I.data)?void 0:t.payment_method_id,{data:G}=(0,B.nc)(W),Y=I&&(null==_?void 0:_.shipping_methods)&&(null==_?void 0:_.shipping_methods.length)!==0,$=(0,i.useCallback)(()=>{if(null==I?void 0:I.id)try{R.mutate({sessionId:I.id,token:null},{onSuccess:()=>{S(null),k(!1)},onError:()=>C("Failed to remove card")})}catch(e){C("Failed to remove card")}},[null==I?void 0:I.id,R]);return((0,i.useEffect)(()=>{if(G){var e;S(ee()(null==G||null==(e=G.card)?void 0:e.brand)),k(!0)}},[G]),_)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-6 md:mb-8 border-t border-grayscale-200 pt-8 mt-8",children:[(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:(0,y.Id)("transition-fontWeight duration-75",L&&"font-semibold"),children:"4. Payment"})}),!L&&Y&&(0,n.jsx)(N.Button,{variant:"link",onPress:()=>{O.push(U+"?"+A("step","payment"),{scroll:!1})},children:"Change"})]}),(0,n.jsxs)("div",{className:L?"block":"hidden",children:[(null==H?void 0:H.length)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.UiRadioGroup,{value:V,onChange:T,"aria-label":"Payment methods",children:H.sort((e,s)=>e.id>s.id?1:-1).map(e=>(0,n.jsx)(es,{paymentInfoMap:p,paymentProviderId:e.id},e.id))}),K&&Q&&(0,n.jsx)("div",{className:"mt-5",children:m(V)&&((null==G||null==(o=G.card)?void 0:o.brand)?(0,n.jsx)(w.Input,{value:"**** **** **** "+(null==G?void 0:G.card.last4),placeholder:"Card number",disabled:!0}):(0,n.jsx)(d.CardElement,{options:M,onChange:e=>{var s;S(e.brand&&e.brand.charAt(0).toUpperCase()+e.brand.slice(1)),C((null==(s=e.error)?void 0:s.message)||null),k(e.complete)}}))})]}),(0,n.jsx)(F.A,{error:b,"data-testid":"payment-method-error-message"}),G&&m(V)&&(0,n.jsx)(N.Button,{className:"mt-6 mr-6",onPress:$,isLoading:j,isDisabled:!z,"data-testid":"submit-payment-button",children:"Change card"}),(0,n.jsx)(ea,{setError:C,isLoading:j,setIsLoading:f,selectedPaymentMethod:V,createQueryString:A,cart:_,cardComplete:z})]}),(0,n.jsx)("div",{className:L?"hidden":"block",children:_&&Y&&I?(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsxs)("div",{className:"flex max-sm:flex-col flex-wrap gap-y-2 gap-x-12",children:[(0,n.jsx)("div",{className:"text-grayscale-500",children:"Payment method"}),(0,n.jsx)("div",{className:"text-grayscale-600",children:(null==(c=p[V])?void 0:c.title)||V})]}),(0,n.jsxs)("div",{className:"flex max-sm:flex-col flex-wrap gap-y-2 gap-x-14.5",children:[(0,n.jsx)("div",{className:"text-grayscale-500",children:"Payment details"}),m(V)&&P?(0,n.jsxs)("div",{className:"text-grayscale-600 flex items-center gap-2",children:[(null==(h=p[V])?void 0:h.icon)||(0,n.jsx)(u.A,{}),(0,n.jsx)("p",{children:P})]}):(0,n.jsx)("div",{children:(0,n.jsx)("p",{children:"Please enter card details"})})]})]}):null})]}):null},er=e=>{let{size:s="16",color:l="currentColor",...a}=e;return(0,n.jsxs)("svg",{className:"animate-spin",width:s,height:s,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",...a,children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:l,strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:l,d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},et=e=>{var s,l,a;let{cart:t,notReady:o}=e,[c,u]=(0,i.useState)(!1),[p,m]=(0,i.useState)(null),h=(0,B.VE)(),g=(0,r.useRouter)(),v=()=>{h.mutate(null,{onSuccess:e=>{if((null==e?void 0:e.type)==="order"){var s,l;let n=null==(l=e.order.shipping_address)||null==(s=l.country_code)?void 0:s.toLowerCase();g.push("/".concat(n,"/order/confirmed/").concat(e.order.id))}else(null==e?void 0:e.error)&&m(e.error.message);u(!1)},onError:e=>{m(e.message),u(!1)}})},x=(0,d.useStripe)(),_=null==(l=t.payment_collection)||null==(s=l.payment_sessions)?void 0:s.find(e=>"pending"===e.status),j=!x||null==_||null==(a=_.data)||!a.payment_method_id,y=async()=>{var e;if(u(!0),!x)return void u(!1);let s=null==_||null==(e=_.data)?void 0:e.payment_method_id;await x.confirmCardPayment(null==_?void 0:_.data.client_secret,{payment_method:s}).then(e=>{let{error:s,paymentIntent:l}=e;if(s){let e=s.payment_intent;(e&&"requires_capture"===e.status||e&&"succeeded"===e.status)&&v(),m(s.message||null);return}if(l&&"requires_capture"===l.status||"succeeded"===l.status)return v()})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(N.Button,{isDisabled:j||o,onPress:y,isLoading:c,className:"w-full",children:"Place order"}),(0,n.jsx)(F.A,{error:p})]})},ed=e=>{var s,l;let{cart:a,notReady:t}=e,[d,o]=(0,i.useState)(!1),[u,p]=(0,i.useState)(null),m=(0,r.useRouter)(),h=(0,B.VE)(),g=()=>{h.mutate(null,{onSuccess:e=>{if((null==e?void 0:e.type)==="order"){var s,l;let n=null==(l=e.order.shipping_address)||null==(s=l.country_code)?void 0:s.toLowerCase();m.push("/".concat(n,"/order/confirmed/").concat(e.order.id))}else(null==e?void 0:e.error)&&p(e.error.message);o(!1)},onError:e=>{p(e.message),o(!1)}})},v=null==(l=a.payment_collection)||null==(s=l.payment_sessions)?void 0:s.find(e=>"pending"===e.status),x=async(e,s)=>{var l;null==s||null==(l=s.order)||l.authorize().then(e=>{if("COMPLETED"!==e.status)return void p("An error occurred, status: ".concat(e.status));g()}).catch(()=>{p("An unknown error occurred, please try again."),o(!1)})},[{isPending:_,isResolved:j}]=(0,c.Gi)();return _?(0,n.jsx)(er,{}):j?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.JV,{style:{layout:"horizontal"},createOrder:async()=>null==v?void 0:v.data.id,onApprove:x,disabled:t||d||_}),(0,n.jsx)(F.A,{error:u})]}):void 0},eo=e=>{let{notReady:s}=e,[l,a]=(0,i.useState)(null),t=(0,B.VE)(),d=(0,r.useRouter)(),o=()=>{t.mutate(null,{onSuccess:e=>{if((null==e?void 0:e.type)==="order"){var s,l;let n=null==(l=e.order.shipping_address)||null==(s=l.country_code)?void 0:s.toLowerCase();d.push("/".concat(n,"/order/confirmed/").concat(e.order.id))}else(null==e?void 0:e.error)&&a(e.error.message)},onError:e=>{a(e.message)}})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(N.Button,{isDisabled:s,isLoading:t.isPending,onPress:()=>{o()},className:"w-full",children:"Place order"}),(0,n.jsx)(F.A,{error:l})]})},ec=(0,a.R)(e=>{var s,l,a,i;let{cart:r,selectPaymentMethod:t}=e,d=!r||!r.shipping_address||!r.billing_address||!r.email||(null!=(i=null==(s=r.shipping_methods)?void 0:s.length)?i:0)<1,o=null==(a=r.payment_collection)||null==(l=a.payment_sessions)?void 0:l[0];switch(!0){case m(null==o?void 0:o.provider_id):return(0,n.jsx)(et,{notReady:d,cart:r});case g(null==o?void 0:o.provider_id):return(0,n.jsx)(eo,{notReady:d});case h(null==o?void 0:o.provider_id):return(0,n.jsx)(ed,{notReady:d,cart:r});default:return(0,n.jsx)(N.Button,{className:"w-full",onPress:()=>{t()},children:"Select a payment method"})}}),eu=e=>{let{cart:s}=e,l=(0,r.useSearchParams)(),a=(0,r.useRouter)(),i=(0,r.usePathname)(),t="review"===l.get("step"),d=s.shipping_address&&s.shipping_methods&&s.shipping_methods.length>0&&s.payment_collection;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-6 md:mb-8 border-t border-grayscale-200 pt-8 mt-8",children:[(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:(0,y.Id)("transition-fontWeight duration-75",t&&"font-semibold"),children:"5. Review"})}),!t&&d&&(null==s?void 0:s.shipping_address)&&(null==s?void 0:s.billing_address)&&(null==s?void 0:s.email)&&(0,n.jsx)(N.Button,{variant:"link",onPress:()=>{a.push(i+"?step=review",{scroll:!1})},children:"View"})]}),t&&d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"mb-8",children:"By clicking the Place Order button, you confirm that you have read, understand and accept our Terms of Use, Terms of Sale and Returns Policy and acknowledge that you have read Medusa Store's Privacy Policy."}),(0,n.jsx)(ec,{cart:s,selectPaymentMethod:()=>{a.push(i+"?step=payment",{scroll:!1})}})]})]})};var ep=l(38292);let em=(0,a.R)(e=>{let{countryCode:s,step:l}=e,{data:a,isPending:t}=(0,B._$)({enabled:!0}),d=(0,r.useRouter)();return(i.useEffect(()=>{if(!l&&a){let e=(0,ep.N)(a);d.push("/".concat(s,"/checkout?step=").concat(e))}},[l,s,a]),t)?(0,n.jsx)("div",{className:"absolute left-0 top-20 md:top-40 lg:top-0 w-[100vw] lg:max-w-[calc(100vw-((50vw-50%)+448px))] xl:max-w-[calc(100vw-((50vw-50%)+540px))] -ml-[calc(50vw-50%)] h-screen lg:w-full flex items-center justify-center",children:(0,n.jsx)(S.I,{name:"loader",className:"w-10 md:w-20 animate-spin"})}):a?(0,n.jsxs)(j,{cart:a,children:[(0,n.jsx)(O,{countryCode:s,cart:a}),(0,n.jsx)(q,{cart:a}),(0,n.jsx)(J,{cart:a}),(0,n.jsx)(ei,{cart:a}),(0,n.jsx)(eu,{cart:a})]}):null})},85676:(e,s,l)=>{"use strict";l.r(s),l.d(s,{UiCloseButton:()=>c,UiConfirmButton:()=>u,UiDialog:()=>o,UiDialogTrigger:()=>d});var n=l(96036),a=l(96456),i=l(84735),r=l(88942),t=l(14724);let d=e=>{let{children:s,...l}=e;return(0,n.jsx)(i.zM,{...l,children:s})},o=e=>{let{children:s,className:l,...a}=e;return(0,n.jsx)(i.lG,{...a,className:(0,r.QP)("focus-visible:outline-none",l),children:s})},c=e=>{let{close:s}=a.useContext(i.RG);return(0,n.jsx)(t.Button,{...e,onPress:s})},u=e=>{let{close:s}=a.useContext(i.RG),l=a.useCallback(async l=>{var n;await e.onConfirm(),s(),null==(n=e.onPress)||n.call(e,l)},[e,s]);return(0,n.jsx)(t.Button,{...e,onPress:l})}}},e=>{var s=s=>e(e.s=s);e.O(0,[8566,534,4550,8775,6303,434,382,8252,5633,3012,4724,4032,2510,5740,4323,7358],()=>s(52343)),_N_E=e.O()}]);